<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>企微参数解析</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:20px;font-size:14px;}
    .key{font-weight:bold;margin-top:10px;}
    .val{margin-left:20px;word-break:break-all;}
  </style>
</head>
<body>
  <h1>企微 URL 参数解析结果</h1>
  <div id="result">正在解析…</div>

<script>
/* ---------------- 1. 固定配置 ---------------- */
const KEY = '03A1B7280B5BC-F60B934C-CABD-4272-94EF-CF99BAF32B8D';
const IV  = '03A1B7280B5BC-3053BBF3-0A52-4A49-ACD8-AF5CC45C96F3';

/* 取 16 字节 hex（AES-128-CBC 需要 128 bit） */
const keyHex = KEY.replace(/-/g,'').slice(0,32);
const ivHex  = IV.replace(/-/g,'').slice(0,32);

/* ---------------- 2. 解密函数 ---------------- */
function decrypt(base64Cipher){
  try{
    const decrypted = CryptoJS.AES.decrypt(
      { ciphertext: CryptoJS.enc.Base64.parse(base64Cipher) },
      CryptoJS.enc.Hex.parse(keyHex),
      { iv: CryptoJS.enc.Hex.parse(ivHex), mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
    );
    return decrypted.toString(CryptoJS.enc.Utf8) || '(解密为空)';
  }catch(e){
    return '(解密异常)';
  }
}

/* ---------------- 3. 解析 & 展示 ---------------- */
const params = new URLSearchParams(location.search);
const encryptedKeys = [
  'rd','fsw','fsh','ph','un','qd','srm','rm',
  'nc','fnc','rn','ts','fp','rtp','rta','fopenid','orderId'
];

let html = '';
for (const [k, v] of params){
  let show = v || '(空)';
  if (v && encryptedKeys.includes(k)){
    show = decrypt(decodeURIComponent(v));
  }
  html += `<div class="key">${k}</div><div class="val">${show}</div>`;
}
document.getElementById('result').innerHTML = html;
</script>

<!-- CryptoJS CDN -->
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
</body>
</html>